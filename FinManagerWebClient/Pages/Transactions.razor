@page "/"
@page "/transactions"
@using FinManagerWebClient.Components.Transactions
@inject ITransactionService transactionService


<PageTitle>Transactions</PageTitle>

<TransactionsTable Transactions="@transactions"
                   TransactionWasRemovedCallback="LoadTransactionsAsync"
                   EditingRowWasChosenCallback="EditRow"/>

<TransactionForm Transaction="@transaction"
                 TransactionsWereChangedCallback="@LoadTransactionsAsync"
                 @bind-SubmitBtnText="submitBtnText"/>

@code {
    TransactionVM transaction = new TransactionVM() { DateTime = DateTime.Now };
    List<TransactionVM> transactions = new List<TransactionVM>();
    string submitBtnText = "Добавить";

    protected override async Task OnInitializedAsync()
    {
        await LoadTransactionsAsync();
        base.OnInitialized();
    }

    void EditRow(TransactionVM t)
    {
        transaction.Id = t.Id;
        transaction.Sum = t.Sum;
        transaction.DateTime = t.DateTime;
        transaction.Discription = t.Discription;
        transaction.OperationId = t.OperationId;

        submitBtnText = "Сохранить";
    }

    private async Task LoadTransactionsAsync()
    {
        transactions = await transactionService.GetAsync();
    }
}